<!DOCTYPE html>
<html>
<head>
    <title>PBR Shader</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        const scene = new THREE.Scene();

        // กล้อง
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 5);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        // แสง
        const ambientLight = new THREE.AmbientLight(0x555555);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
        directionalLight.position.set(10, 5, 10);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        // พื้น
        const texture = new THREE.TextureLoader().load(
            "https://raw.githubusercontent.com/THEkingmay/comgraphic_objLoader/main/gray_rocks_diff_1k.jpg",
            () => console.log("✅ Texture โหลดเสร็จ"),
            undefined,
            err => console.error("❌ โหลด texture ไม่ได้", err)
        );

        texture.wrapS = THREE.RepeatWrapping;
        texture.wrapT = THREE.RepeatWrapping;
        texture.repeat.set(2, 2);

        const floorMaterial = new THREE.MeshStandardMaterial({ map: texture });
        const floorGeom = new THREE.PlaneGeometry(10, 10);
        const floorMesh = new THREE.Mesh(floorGeom, floorMaterial);
        floorMesh.rotation.x = -Math.PI / 2;
        floorMesh.receiveShadow = true;
        scene.add(floorMesh);

        // โหลดโมเดล
        const loader = new THREE.GLTFLoader();

        function loadModel(url, position) {
            loader.load(
                url,
                gltf => {
                    const obj = gltf.scene;
                    obj.traverse(child => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });
                    obj.position.copy(position);
                    scene.add(obj);
                    console.log(`✅ โหลดโมเดล: ${url}`);
                },
                undefined,
                err => console.error(`❌ โหลดโมเดลไม่ได้: ${url}`, err)
            );
        }

        loadModel("https://raw.githubusercontent.com/THEkingmay/comgraphic_objLoader/main/car-house.glb", new THREE.Vector3(0, 0, 2));
        loadModel("https://raw.githubusercontent.com/THEkingmay/comgraphic_objLoader/main/oiiaioooooiai_cat.glb", new THREE.Vector3(-2, 0, 2));
        loadModel("https://raw.githubusercontent.com/THEkingmay/comgraphic_objLoader/main/robot_from_the_series_love_death_and_robots.glb", new THREE.Vector3(2, 0, 2));

        window.addEventListener('keydown', e => {
            const step = 0.3;   // ระยะการเคลื่อนที่
            const angle = 0.1;  // องศาการหมุน
            const lightStep = 0.2; // การปรับความสว่าง
            switch (e.key) {
                // === ควบคุมตำแหน่งแสง ===
                case "w": directionalLight.position.z -= step; break;
                case "s": directionalLight.position.z += step; break;
                case "a": directionalLight.position.x -= step; break;
                case "d": directionalLight.position.x += step; break;
                case "ArrowUp": directionalLight.position.y += step; break;
                case "ArrowDown": directionalLight.position.y -= step; break;

                // === หมุนไฟรอบฉาก ===
                case "q": directionalLight.rotation.y -= angle; break;
                case "e": directionalLight.rotation.y += angle; break;

                // === ปรับความสว่าง ===
                case "+": directionalLight.intensity += lightStep; break;
                case "-": directionalLight.intensity = Math.max(0, directionalLight.intensity - lightStep); break;

        }});

        // Render
        function animate() {
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
